<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Chore Adventure Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Mode Switcher */
        .mode-switcher {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .mode-btn {
            padding: 12px 24px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .mode-btn.harry {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
        }

        .mode-btn.princess {
            background: linear-gradient(135deg, #ff6eb4 0%, #ff9a9e 100%);
            color: white;
        }

        .mode-btn.parent {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .mode-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .mode-btn.active {
            transform: scale(1.05);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }

        /* Player Info */
        .player-info {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .player-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .player-name {
            font-size: 32px;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .level-badge {
            display: inline-block;
            padding: 8px 16px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border-radius: 20px;
            font-weight: bold;
            font-size: 18px;
        }

        .progress-section {
            margin-top: 20px;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            transition: width 0.5s ease;
            position: relative;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            font-size: 14px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }

        /* Chore Cards */
        .chores-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .chore-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .chore-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .chore-card.completed {
            opacity: 0.7;
            background: #f0f0f0;
        }

        .chore-card.pending {
            border: 3px solid #ffd700;
            background: #fffef0;
        }

        .chore-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .chore-points {
            display: inline-block;
            background: #ffd700;
            color: #333;
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .chore-frequency {
            display: inline-block;
            background: #e0e0e0;
            color: #666;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            margin-left: 10px;
        }

        .chore-status {
            font-size: 14px;
            color: #666;
            margin-bottom: 15px;
        }

        .chore-btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
        }

        .start-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .complete-btn {
            background: linear-gradient(135deg, #36d1dc 0%, #5b86e5 100%);
        }

        .chore-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .chore-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translate(-50%, -40%);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%);
            }
        }

        .modal-header {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 30px;
            cursor: pointer;
            color: #999;
            transition: color 0.3s ease;
        }

        .modal-close:hover {
            color: #333;
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-checkbox {
            margin-right: 10px;
        }

        .form-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .form-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        /* Challenge Game */
        .challenge-container {
            text-align: center;
            padding: 20px;
        }

        .challenge-question {
            font-size: 20px;
            margin-bottom: 20px;
            color: #333;
            line-height: 1.5;
        }

        .challenge-input {
            padding: 12px;
            font-size: 18px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            width: 100%;
            max-width: 300px;
            margin-bottom: 20px;
            text-align: center;
        }

        .challenge-btn {
            background: linear-gradient(135deg, #36d1dc 0%, #5b86e5 100%);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0 5px;
        }

        .challenge-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        /* Parent Controls */
        .parent-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .section-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
        }

        .pending-approval {
            background: #fffef0;
            border: 2px solid #ffd700;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .approval-info {
            flex: 1;
        }

        .approval-btns {
            display: flex;
            gap: 10px;
        }

        .approve-btn {
            background: linear-gradient(135deg, #36d1dc 0%, #5b86e5 100%);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .reject-btn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .approve-btn:hover, .reject-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            animation: slideInRight 0.5s ease;
            z-index: 2000;
            max-width: 300px;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .notification.success {
            border-left: 5px solid #36d1dc;
        }

        .notification.error {
            border-left: 5px solid #f5576c;
        }

        .notification-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        .notification-message {
            color: #666;
        }

        /* Celebration */
        .celebration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 3000;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #ffd700;
            animation: fall 3s linear;
        }

        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .game-container {
                padding: 10px;
            }

            .player-name {
                font-size: 24px;
            }

            .chores-container {
                grid-template-columns: 1fr;
            }

            .modal-content {
                padding: 20px;
            }
        }

        /* Theme Overrides */
        .harry-theme {
            --primary-gradient: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            --secondary-color: #2a5298;
        }

        .princess-theme {
            --primary-gradient: linear-gradient(135deg, #ff6eb4 0%, #ff9a9e 100%);
            --secondary-color: #ff6eb4;
        }

        .harry-theme .progress-fill,
        .harry-theme .start-btn,
        .harry-theme .form-btn {
            background: var(--primary-gradient);
        }

        .princess-theme .progress-fill,
        .princess-theme .start-btn,
        .princess-theme .form-btn {
            background: var(--primary-gradient);
        }

        /* Manage Chores List */
        .chore-list-item {
            background: #f8f8f8;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .chore-list-info {
            flex: 1;
        }

        .chore-list-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .chore-list-details {
            font-size: 14px;
            color: #666;
        }

        .delete-btn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .delete-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .assignment-tags {
            display: flex;
            gap: 5px;
            margin-top: 5px;
        }

        .assignment-tag {
            background: #e0e0e0;
            color: #666;
            padding: 3px 8px;
            border-radius: 15px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Mode Switcher -->
        <div class="mode-switcher">
            <button class="mode-btn harry active" onclick="switchMode('harry')">
                üßô‚Äç‚ôÇÔ∏è Harry's Wizarding Academy
            </button>
            <button class="mode-btn princess" onclick="switchMode('princess')">
                üë∏ Princess Unicorn Kingdom
            </button>
            <button class="mode-btn parent" onclick="switchMode('parent')">
                üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Quest Master (Parent)
            </button>
        </div>

        <!-- Game Content -->
        <div id="gameContent"></div>
    </div>

    <!-- Modals -->
    <div id="pinModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('pinModal')">&times;</span>
            <h2 class="modal-header">Enter Parent PIN</h2>
            <div class="form-group">
                <input type="password" id="pinInput" class="form-input" placeholder="Enter PIN">
            </div>
            <button class="form-btn" onclick="checkPin()">Submit</button>
        </div>
    </div>

    <div id="challengeModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('challengeModal')">&times;</span>
            <h2 class="modal-header">Challenge Time!</h2>
            <div id="challengeContent"></div>
        </div>
    </div>

    <div id="addChoreModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('addChoreModal')">&times;</span>
            <h2 class="modal-header">Add New Chore</h2>
            <form onsubmit="addChore(event)">
                <div class="form-group">
                    <label class="form-label">Chore Name</label>
                    <input type="text" id="choreName" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Star Points (1-10)</label>
                    <input type="number" id="chorePoints" class="form-input" min="1" max="10" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Frequency</label>
                    <select id="choreFrequency" class="form-select" required>
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                        <option value="monthly">Monthly</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Assign To:</label>
                    <div>
                        <label>
                            <input type="checkbox" id="assignHarry" class="form-checkbox" checked>
                            Harry
                        </label>
                    </div>
                    <div>
                        <label>
                            <input type="checkbox" id="assignPrincess" class="form-checkbox" checked>
                            Princess
                        </label>
                    </div>
                </div>
                <button type="submit" class="form-btn">Add Chore</button>
            </form>
        </div>
    </div>

    <script>
        // Game State
        const PARENT_PIN = '1234';
        let currentMode = 'harry';
        let gameState = {
            harry: {
                level: 1,
                stars: 0,
                completedChores: [],
                lastResets: {
                    daily: null,
                    weekly: null,
                    monthly: null
                }
            },
            princess: {
                level: 1,
                stars: 0,
                completedChores: [],
                lastResets: {
                    daily: null,
                    weekly: null,
                    monthly: null
                }
            },
            settings: {
                starTarget: 10
            },
            chores: [
                {
                    id: 1,
                    name: 'make bed',
                    points: 2,
                    frequency: 'daily',
                    assignedTo: ['harry', 'princess'],
                    status: {
                        harry: 'available',
                        princess: 'available'
                    }
                },
                {
                    id: 2,
                    name: 'put away toys',
                    points: 1,
                    frequency: 'daily',
                    assignedTo: ['harry', 'princess'],
                    status: {
                        harry: 'available',
                        princess: 'available'
                    }
                },
                {
                    id: 3,
                    name: 'clean room',
                    points: 3,
                    frequency: 'weekly',
                    assignedTo: ['harry', 'princess'],
                    status: {
                        harry: 'available',
                        princess: 'available'
                    }
                },
                {
                    id: 4,
                    name: 'put away clothes',
                    points: 2,
                    frequency: 'daily',
                    assignedTo: ['harry', 'princess'],
                    status: {
                        harry: 'available',
                        princess: 'available'
                    }
                },
                {
                    id: 5,
                    name: 'organize shoe cupboard',
                    points: 4,
                    frequency: 'monthly',
                    assignedTo: ['harry', 'princess'],
                    status: {
                        harry: 'available',
                        princess: 'available'
                    }
                }
            ],
            pendingApprovals: []
        };

        // Theme Mappings
        const wizardTheme = {
            keywords: {
                'bed': 'magical dormitory bed',
                'toys': 'magical artifacts',
                'room': 'Hogwarts dormitory',
                'clothes': 'wizard robes',
                'shoes': 'magical footwear',
                'shoe cupboard': 'magical footwear storage',
                'drawers': 'magical storage chambers',
                'kitchen': 'potions laboratory',
                'dishes': 'cauldrons and magical vessels',
                'bathroom': 'magical washroom'
            },
            verbs: {
                'make': 'enchant',
                'clean': 'purify',
                'organize': 'arrange magically',
                'put away': 'store in magical order',
                'tidy': 'cast tidying charms on'
            }
        };

        const princessTheme = {
            keywords: {
                'bed': 'royal princess bed',
                'toys': 'royal treasures',
                'room': 'princess chambers',
                'clothes': 'royal gowns',
                'shoes': 'royal shoe collection',
                'shoe cupboard': 'royal shoe collection storage',
                'drawers': 'royal treasure drawers',
                'kitchen': 'royal kitchen',
                'dishes': 'royal china and crystal',
                'bathroom': 'royal powder room'
            },
            verbs: {
                'make': 'prepare royally',
                'clean': 'beautify',
                'organize': 'arrange elegantly',
                'put away': 'store in royal order',
                'tidy': 'make palace-perfect'
            }
        };

        // Harry's Challenges
        const harryMathProblems = [
            { question: "If you have 7 chocolate frogs and eat 3, then buy 5 more, how many do you have?", answer: "9" },
            { question: "Hogwarts has 4 houses with 15 students each. How many students total?", answer: "60" },
            { question: "A Quidditch match lasts 3 hours. How many minutes is that?", answer: "180" },
            { question: "If a spell requires 12 ingredients and you have 8, how many more do you need?", answer: "4" },
            { question: "You collect 6 spell books each month. How many will you have after 4 months?", answer: "24" },
            { question: "A potion recipe needs 3/4 cup of dragon blood. If you have 1/2 cup, how much more do you need? (Answer as a fraction like 1/4)", answer: "1/4" },
            { question: "If 8 wizards can cast a spell in 2 hours, how long would it take 4 wizards?", answer: "4" },
            { question: "You have 45 galleons and spend 27. How many galleons are left?", answer: "18" },
            { question: "If a broomstick flies 30 miles per hour for 2.5 hours, how far does it go?", answer: "75" },
            { question: "There are 144 students at Hogwarts. If 1/3 are in Gryffindor, how many Gryffindor students are there?", answer: "48" }
        ];

        const harryRiddles = [
            { question: "I fly without wings, I see without eyes. I'm used in Quidditch, what am I?", answer: "SNITCH" },
            { question: "Three heads I have, but one body. Fluffy am I, what creature could I be?", answer: "CERBERUS" },
            { question: "I open at the close, and hold memories dear. What am I?", answer: "SNITCH" },
            { question: "I have no body, but I can possess. I fear one thing above the rest. What am I?", answer: "DEMENTOR" },
            { question: "I'm not alive, but I grow. I don't have lungs, but I need air. I don't have a mouth, but water kills me. What am I?", answer: "FIRE" },
            { question: "The more you take, the more you leave behind. What am I?", answer: "FOOTSTEPS" },
            { question: "I speak without a mouth and hear without ears. I have nobody, but come alive with wind. What am I?", answer: "ECHO" },
            { question: "I'm tall when I'm young, and short when I'm old. What am I?", answer: "CANDLE" },
            { question: "What has keys but no locks, space but no room, and you can enter but not go inside?", answer: "KEYBOARD" },
            { question: "I have cities, but no houses. I have mountains, but no trees. I have water, but no fish. What am I?", answer: "MAP" }
        ];

        // Princess's Challenges
        const princessSpellingWords = [
            { word: "LOVE", hint: "L-O-V-E" },
            { word: "ROSE", hint: "R-O-S-E" },
            { word: "STAR", hint: "S-T-A-R" },
            { word: "CAKE", hint: "C-A-K-E" },
            { word: "MOON", hint: "M-O-O-N" },
            { word: "PINK", hint: "P-I-N-K" },
            { word: "CROWN", hint: "C-R-O-W-N" },
            { word: "MAGIC", hint: "M-A-G-I-C" },
            { word: "SMILE", hint: "S-M-I-L-E" },
            { word: "SHINE", hint: "S-H-I-N-E" }
        ];

        const princessCountingChallenges = [
            { question: "Count the hearts: ‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è", answer: "3" },
            { question: "Count the stars: ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê", answer: "5" },
            { question: "Count the flowers: üå∏üå∏üå∏üå∏", answer: "4" },
            { question: "Count the unicorns: ü¶Ñü¶Ñ", answer: "2" },
            { question: "Count the crowns: üëëüëëüëëüëëüëëüëë", answer: "6" },
            { question: "Count the butterflies: ü¶ãü¶ãü¶ãü¶ãü¶ãü¶ãü¶ã", answer: "7" },
            { question: "Count the rainbows: üåàüåàüåàüåàüåàüåàüåàüåà", answer: "8" },
            { question: "Count the castles: üè∞", answer: "1" },
            { question: "Count the diamonds: üíéüíéüíéüíéüíéüíéüíéüíéüíé", answer: "9" },
            { question: "Count the roses: üåπüåπüåπüåπüåπüåπüåπüåπüåπüåπ", answer: "10" }
        ];

        const princessQuestions = [
            { question: "What color do you get when you mix red and white?", answer: "PINK" },
            { question: "What do princesses wear on their heads?", answer: "CROWN" },
            { question: "What animal has a horn and is magical?", answer: "UNICORN" },
            { question: "What do you make a wish on in the sky at night?", answer: "STAR" },
            { question: "What color is the sun?", answer: "YELLOW" },
            { question: "How many legs does a butterfly have?", answer: "6" },
            { question: "What shape is a rainbow?", answer: "ARCH" },
            { question: "What do bees make that's sweet?", answer: "HONEY" },
            { question: "What season comes after winter?", answer: "SPRING" },
            { question: "How many days are in a week?", answer: "7" }
        ];

        // Initialize game
        function init() {
            loadGameState();
            checkResets();
            renderGame();
            setInterval(saveGameState, 30000); // Auto-save every 30 seconds
        }

        // Load game state from localStorage (with fallback for sandboxed environments)
        function loadGameState() {
            try {
                const saved = localStorage.getItem('choreGameState');
                if (saved) {
                    gameState = JSON.parse(saved);
                }
            } catch (e) {
                // localStorage not available (sandboxed environment)
                console.log('Using in-memory storage only');
            }
        }

        // Save game state to localStorage (with fallback for sandboxed environments)
        function saveGameState() {
            try {
                localStorage.setItem('choreGameState', JSON.stringify(gameState));
            } catch (e) {
                // localStorage not available (sandboxed environment)
                // State is maintained in memory during the session
            }
        }

        // Check for daily/weekly/monthly resets
        function checkResets() {
            const now = new Date();
            const today = now.toDateString();
            const thisWeek = getWeekNumber(now);
            const thisMonth = now.getMonth();

            ['harry', 'princess'].forEach(player => {
                // Daily reset
                if (gameState[player].lastResets.daily !== today) {
                    resetChores(player, 'daily');
                    gameState[player].lastResets.daily = today;
                    showNotification('Daily Reset!', 'Daily chores have been reset!', 'success');
                }

                // Weekly reset
                if (gameState[player].lastResets.weekly !== thisWeek) {
                    resetChores(player, 'weekly');
                    gameState[player].lastResets.weekly = thisWeek;
                    showNotification('Weekly Reset!', 'Weekly chores have been reset!', 'success');
                }

                // Monthly reset
                if (gameState[player].lastResets.monthly !== thisMonth) {
                    resetChores(player, 'monthly');
                    gameState[player].lastResets.monthly = thisMonth;
                    showNotification('Monthly Reset!', 'Monthly chores have been reset!', 'success');
                }
            });
        }

        // Get week number
        function getWeekNumber(date) {
            const firstDayOfYear = new Date(date.getFullYear(), 0, 1);
            const pastDaysOfYear = (date - firstDayOfYear) / 86400000;
            return Math.ceil((pastDaysOfYear + firstDayOfYear.getDay() + 1) / 7);
        }

        // Reset chores by frequency
        function resetChores(player, frequency) {
            gameState.chores.forEach(chore => {
                if (chore.frequency === frequency && chore.assignedTo.includes(player)) {
                    if (chore.status[player] === 'completed') {
                        chore.status[player] = 'available';
                    }
                }
            });
        }

        // Switch game mode
        function switchMode(mode) {
            if (mode === 'parent') {
                document.getElementById('pinModal').style.display = 'block';
                document.getElementById('pinInput').value = '';
                document.getElementById('pinInput').focus();
            } else {
                currentMode = mode;
                document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelector(`.mode-btn.${mode}`).classList.add('active');
                renderGame();
            }
        }

        // Check parent PIN
        function checkPin() {
            const pin = document.getElementById('pinInput').value;
            if (pin === PARENT_PIN) {
                currentMode = 'parent';
                document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelector('.mode-btn.parent').classList.add('active');
                closeModal('pinModal');
                renderGame();
            } else {
                showNotification('Incorrect PIN', 'Please try again.', 'error');
                document.getElementById('pinInput').value = '';
            }
        }

        // Theme chore names
        function themeChore(choreName, player) {
            let themed = choreName.toLowerCase();
            const theme = player === 'harry' ? wizardTheme : princessTheme;

            // Replace keywords
            Object.keys(theme.keywords).forEach(keyword => {
                if (themed.includes(keyword)) {
                    themed = themed.replace(keyword, theme.keywords[keyword]);
                }
            });

            // Replace verbs
            Object.keys(theme.verbs).forEach(verb => {
                if (themed.startsWith(verb + ' ')) {
                    themed = themed.replace(verb + ' ', theme.verbs[verb] + ' ');
                }
            });

            // Capitalize first letter
            return themed.charAt(0).toUpperCase() + themed.slice(1);
        }

        // Render game based on current mode
        function renderGame() {
            const content = document.getElementById('gameContent');
            content.className = currentMode === 'harry' ? 'harry-theme' : currentMode === 'princess' ? 'princess-theme' : '';

            if (currentMode === 'parent') {
                renderParentView(content);
            } else {
                renderChildView(content, currentMode);
            }
        }

        // Render child view
        function renderChildView(container, player) {
            const playerData = gameState[player];
            const playerChores = gameState.chores.filter(chore => chore.assignedTo.includes(player));

            let html = `
                <div class="player-info">
                    <div class="player-header">
                        <h1 class="player-name">
                            ${player === 'harry' ? 'üßô‚Äç‚ôÇÔ∏è Harry\'s Wizarding Academy' : 'üë∏ Princess Unicorn Kingdom'}
                        </h1>
                        <span class="level-badge">Level ${playerData.level}</span>
                    </div>
                    <div class="progress-section">
                        <h3>Progress to Grand Prize</h3>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${(playerData.stars / gameState.settings.starTarget) * 100}%"></div>
                            <div class="progress-text">${playerData.stars} / ${gameState.settings.starTarget} ‚≠ê</div>
                        </div>
                    </div>
                </div>

                <div class="chores-container">
            `;

            playerChores.forEach(chore => {
                const status = chore.status[player];
                const themedName = themeChore(chore.name, player);
                
                html += `
                    <div class="chore-card ${status}">
                        <h3 class="chore-name">${themedName}</h3>
                        <span class="chore-points">‚≠ê ${chore.points} stars</span>
                        <span class="chore-frequency">${chore.frequency}</span>
                        <div class="chore-status">Status: ${status.charAt(0).toUpperCase() + status.slice(1)}</div>
                `;

                if (status === 'available') {
                    html += `<button class="chore-btn start-btn" onclick="startChore(${chore.id}, '${player}')">Start Quest</button>`;
                } else if (status === 'active') {
                    html += `<button class="chore-btn complete-btn" onclick="completeChore(${chore.id}, '${player}')">Complete Quest</button>`;
                } else if (status === 'pending') {
                    html += `<button class="chore-btn" disabled>Awaiting Approval</button>`;
                } else {
                    html += `<button class="chore-btn" disabled>Completed!</button>`;
                }

                html += `</div>`;
            });

            html += `</div>`;
            container.innerHTML = html;
        }

        // Render parent view
        function renderParentView(container) {
            let html = `
                <div class="parent-section">
                    <h2 class="section-title">Quest Master Control Panel</h2>
                    
                    <div class="form-group">
                        <label class="form-label">Star Target for Grand Prize</label>
                        <input type="number" id="starTarget" class="form-input" value="${gameState.settings.starTarget}" min="1" max="50" onchange="updateStarTarget()">
                    </div>

                    <button class="form-btn" onclick="openModal('addChoreModal')">Add New Chore</button>
                </div>

                <div class="parent-section">
                    <h2 class="section-title">Pending Approvals</h2>
            `;

            if (gameState.pendingApprovals.length === 0) {
                html += `<p>No pending approvals</p>`;
            } else {
                gameState.pendingApprovals.forEach((approval, index) => {
                    const chore = gameState.chores.find(c => c.id === approval.choreId);
                    html += `
                        <div class="pending-approval">
                            <div class="approval-info">
                                <strong>${approval.player === 'harry' ? 'Harry' : 'Princess'}</strong> completed: ${chore.name}
                                <br>
                                <small>Worth ${chore.points} stars</small>
                            </div>
                            <div class="approval-btns">
                                <button class="approve-btn" onclick="approveChore(${index})">Approve</button>
                                <button class="reject-btn" onclick="rejectChore(${index})">Reject</button>
                            </div>
                        </div>
                    `;
                });
            }

            html += `
                </div>

                <div class="parent-section">
                    <h2 class="section-title">Manage Chores</h2>
            `;

            gameState.chores.forEach(chore => {
                html += `
                    <div class="chore-list-item">
                        <div class="chore-list-info">
                            <div class="chore-list-name">${chore.name}</div>
                            <div class="chore-list-details">
                                ${chore.points} stars ‚Ä¢ ${chore.frequency}
                            </div>
                            <div class="assignment-tags">
                                ${chore.assignedTo.includes('harry') ? '<span class="assignment-tag">Harry</span>' : ''}
                                ${chore.assignedTo.includes('princess') ? '<span class="assignment-tag">Princess</span>' : ''}
                            </div>
                        </div>
                        <button class="delete-btn" onclick="deleteChore(${chore.id})">Delete</button>
                    </div>
                `;
            });

            html += `</div>`;
            container.innerHTML = html;
        }

        // Start chore
        function startChore(choreId, player) {
            const chore = gameState.chores.find(c => c.id === choreId);
            chore.status[player] = 'active';
            saveGameState();
            renderGame();
            showNotification('Quest Started!', `You've started: ${themeChore(chore.name, player)}`, 'success');
        }

        // Complete chore
        function completeChore(choreId, player) {
            const chore = gameState.chores.find(c => c.id === choreId);
            currentChoreId = choreId;
            currentPlayer = player;
            
            // Show challenge modal
            document.getElementById('challengeModal').style.display = 'block';
            renderChallenge(player);
        }

        // Render challenge
        function renderChallenge(player) {
            const container = document.getElementById('challengeContent');
            let challenge;

            if (player === 'harry') {
                // Harry gets math problems or riddles
                if (Math.random() < 0.5) {
                    challenge = harryMathProblems[Math.floor(Math.random() * harryMathProblems.length)];
                } else {
                    challenge = harryRiddles[Math.floor(Math.random() * harryRiddles.length)];
                }
            } else {
                // Princess gets spelling, counting, or simple questions
                const type = Math.floor(Math.random() * 3);
                if (type === 0) {
                    const spelling = princessSpellingWords[Math.floor(Math.random() * princessSpellingWords.length)];
                    challenge = {
                        question: `Spell this magical word: ${spelling.hint}`,
                        answer: spelling.word
                    };
                } else if (type === 1) {
                    challenge = princessCountingChallenges[Math.floor(Math.random() * princessCountingChallenges.length)];
                } else {
                    challenge = princessQuestions[Math.floor(Math.random() * princessQuestions.length)];
                }
            }

            currentChallenge = challenge;

            container.innerHTML = `
                <div class="challenge-container">
                    <div class="challenge-question">${challenge.question}</div>
                    <input type="text" id="challengeAnswer" class="challenge-input" placeholder="Your answer">
                    <div>
                        <button class="challenge-btn" onclick="checkChallenge()">Submit</button>
                        <button class="challenge-btn" onclick="skipChallenge()">Skip</button>
                    </div>
                </div>
            `;

            document.getElementById('challengeAnswer').focus();
        }

        // Check challenge answer
        function checkChallenge() {
            const answer = document.getElementById('challengeAnswer').value.toUpperCase().trim();
            if (answer === currentChallenge.answer.toUpperCase()) {
                submitChoreForApproval();
                closeModal('challengeModal');
                showNotification('Great job!', 'Challenge completed successfully!', 'success');
            } else {
                showNotification('Try again!', 'That\'s not quite right. Keep trying!', 'error');
                document.getElementById('challengeAnswer').value = '';
            }
        }

        // Skip challenge
        function skipChallenge() {
            submitChoreForApproval();
            closeModal('challengeModal');
        }

        // Submit chore for approval
        function submitChoreForApproval() {
            const chore = gameState.chores.find(c => c.id === currentChoreId);
            chore.status[currentPlayer] = 'pending';
            
            gameState.pendingApprovals.push({
                choreId: currentChoreId,
                player: currentPlayer,
                timestamp: new Date().toISOString()
            });

            saveGameState();
            renderGame();
            showNotification('Quest Completed!', 'Waiting for parent approval...', 'success');
        }

        // Approve chore
        function approveChore(index) {
            const approval = gameState.pendingApprovals[index];
            const chore = gameState.chores.find(c => c.id === approval.choreId);
            const player = approval.player;

            // Award stars
            gameState[player].stars += chore.points;
            
            // Check for level up
            const newLevel = Math.floor(gameState[player].stars / 5) + 1;
            if (newLevel > gameState[player].level) {
                gameState[player].level = newLevel;
                showNotification('Level Up!', `${player === 'harry' ? 'Harry' : 'Princess'} reached level ${newLevel}!`, 'success');
            }

            // Check for grand prize
            if (gameState[player].stars >= gameState.settings.starTarget) {
                celebrate();
                showNotification('Grand Prize!', `${player === 'harry' ? 'Harry' : 'Princess'} has earned the grand prize!`, 'success');
                // Reset stars after grand prize
                gameState[player].stars = 0;
            }

            // Mark chore as completed
            chore.status[player] = 'completed';
            
            // Remove from pending
            gameState.pendingApprovals.splice(index, 1);

            saveGameState();
            renderGame();
            showNotification('Approved!', `${chore.points} stars awarded!`, 'success');
        }

        // Reject chore
        function rejectChore(index) {
            const approval = gameState.pendingApprovals[index];
            const chore = gameState.chores.find(c => c.id === approval.choreId);
            
            // Return to available status
            chore.status[approval.player] = 'available';
            
            // Remove from pending
            gameState.pendingApprovals.splice(index, 1);

            saveGameState();
            renderGame();
            showNotification('Rejected', 'Chore returned to available status', 'error');
        }

        // Add new chore
        function addChore(event) {
            event.preventDefault();
            
            const name = document.getElementById('choreName').value;
            const points = parseInt(document.getElementById('chorePoints').value);
            const frequency = document.getElementById('choreFrequency').value;
            const assignHarry = document.getElementById('assignHarry').checked;
            const assignPrincess = document.getElementById('assignPrincess').checked;

            if (!assignHarry && !assignPrincess) {
                showNotification('Error', 'Please assign the chore to at least one child', 'error');
                return;
            }

            const assignedTo = [];
            if (assignHarry) assignedTo.push('harry');
            if (assignPrincess) assignedTo.push('princess');

            const newChore = {
                id: Date.now(),
                name: name.toLowerCase(),
                points: points,
                frequency: frequency,
                assignedTo: assignedTo,
                status: {
                    harry: 'available',
                    princess: 'available'
                }
            };

            gameState.chores.push(newChore);
            saveGameState();
            closeModal('addChoreModal');
            renderGame();
            showNotification('Chore Added!', `${name} has been added to the quest list!`, 'success');
        }

        // Delete chore
        function deleteChore(choreId) {
            if (confirm('Are you sure you want to delete this chore?')) {
                gameState.chores = gameState.chores.filter(c => c.id !== choreId);
                // Also remove any pending approvals for this chore
                gameState.pendingApprovals = gameState.pendingApprovals.filter(a => a.choreId !== choreId);
                saveGameState();
                renderGame();
                showNotification('Deleted', 'Chore has been removed', 'success');
            }
        }

        // Update star target
        function updateStarTarget() {
            const target = parseInt(document.getElementById('starTarget').value);
            if (target > 0 && target <= 50) {
                gameState.settings.starTarget = target;
                saveGameState();
                showNotification('Updated', `Star target set to ${target}`, 'success');
            }
        }

        // Show notification
        function showNotification(title, message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div class="notification-title">${title}</div>
                <div class="notification-message">${message}</div>
            `;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Celebrate (confetti animation)
        function celebrate() {
            const celebration = document.createElement('div');
            celebration.className = 'celebration';
            document.body.appendChild(celebration);

            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.backgroundColor = ['#ffd700', '#ff6eb4', '#36d1dc', '#f093fb'][Math.floor(Math.random() * 4)];
                confetti.style.animationDelay = Math.random() * 3 + 's';
                celebration.appendChild(confetti);
            }

            setTimeout(() => {
                celebration.remove();
            }, 3000);
        }

        // Modal functions
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Global variables for current challenge
        let currentChoreId = null;
        let currentPlayer = null;
        let currentChallenge = null;

        // Initialize game on load
        window.onload = init;

        // Handle Enter key for PIN input
        document.addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                if (document.getElementById('pinModal').style.display === 'block') {
                    checkPin();
                } else if (document.getElementById('challengeModal').style.display === 'block') {
                    checkChallenge();
                }
            }
        });

        // Close modals when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        };
    </script>
</body>
</html>
